# Project Configuration
project_id = "infra-474223"  # Existing GCP project ID

# Region / Cluster Logical Names
region                 = "us-central1"
primary_cluster_name   = "master-engine"
secondary_cluster_name = "app-engine"
argocd_target_cluster  = "master-engine"

# VPC Configuration
network_name = "main-vpc"
manage_network = true

# Subnets Configuration
subnets = [
  {
    name          = "subnet-us-central1"
    ip_cidr_range = "10.0.1.0/24"
    region        = "us-central1"
    description   = "Subnet for us-central1 region"
  },
  {
    name          = "subnet-us-east1"
    ip_cidr_range = "10.0.2.0/24"
    region        = "us-east1"
    description   = "Subnet for us-east1 region"
  }
]

# Secondary IP Ranges for GKE (pods and services)
secondary_ranges = {
  "subnet-us-central1" = [
    {
      range_name    = "pods"
      ip_cidr_range = "10.1.0.0/16"
    },
    {
      range_name    = "services"
      ip_cidr_range = "10.2.0.0/20"
    }
  ]
  "subnet-us-east1" = [
    {
      range_name    = "pods"
      ip_cidr_range = "10.3.0.0/16"
    },
    {
      range_name    = "services"
      ip_cidr_range = "10.4.0.0/20"
    }
  ]
}

# GKE Clusters Configuration
gke_clusters = {
  master-engine = {
    region                = "us-central1"
    zone                  = "us-central1-a"
    initial_node_count    = 1
    min_node_count        = 1
    max_node_count        = 5
    machine_type          = "e2-medium"
    disk_size_gb          = 50
    enable_private_nodes  = true
    enable_private_endpoint = false
    master_authorized_networks = []  # Add CIDR blocks if needed for private endpoint access
  }
  app-engine = {
    region                = "us-east1"
    zone                  = "us-east1-b"
    initial_node_count    = 1
    min_node_count        = 1
    max_node_count        = 5
    machine_type          = "e2-medium"
    disk_size_gb          = 50
    enable_private_nodes  = true
    enable_private_endpoint = false
    master_authorized_networks = []
  }
}

# Controla a instalação dos add-ons (Istio, gateways, ArgoCD).
# Fluxo sugerido:
# 1) terraform apply -var enable_cluster_addons=false
# 2) terraform apply -var enable_cluster_addons=true
enable_cluster_addons = false

# ASM / Istio / Add-ons
istio_namespace      = "istio-system"
gateway_namespace    = "istio-ingress"
asm_revision         = "asm-managed"
istio_chart_version  = "1.21.1"
install_gateway      = true
install_argocd       = true
argocd_namespace     = "argocd"
argocd_chart_version = "7.3.6"

# Customizações opcionais
istiod_values = {
  meshConfig = {
    accessLogFile = "/dev/stdout"
  }
}

istio_gateway_values = {
  service = {
    type = "LoadBalancer"
  }
}

argocd_values = {
  server = {
    service = {
      type = "LoadBalancer"
    }
  }
}

